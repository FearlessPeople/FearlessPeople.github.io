(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{463:function(s,a,t){"use strict";t.r(a);var n=t(10),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),t("p",[s._v("本文主要是记录Flume的各种sources和sink结合使用时的配置信息，由于Flume支持的sources和sink很多，这里只是拿一些常用的来记录。\n本文会根据情况不定期更新")]),s._v(" "),t("h2",{attrs:{id:"实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[s._v("#")]),s._v(" 实例")]),s._v(" "),t("h3",{attrs:{id:"exec到hdfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#exec到hdfs"}},[s._v("#")]),s._v(" exec到hdfs")]),s._v(" "),t("p",[s._v("实现目标：实现从sources(exec)到sink(hdfs)的数据采集，实现将一条shell命令的结果存储到hdfs中")]),s._v(" "),t("h4",{attrs:{id:"agent配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#agent配置"}},[s._v("#")]),s._v(" agent配置")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent、sources、sinks、channels")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#--------sources-----------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exec sources")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#执行一个cmd命令，将执行结果作为输入")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这里的command可以是一个linux命令(tail -F /fileName)或者执行一个shell脚本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#例如：可以使用tail -F命令监控某.log文件的变化，然后输出到hdfs中")]),s._v("\na1.sources.r1.command "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" to hdfs\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#--------sink--------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HDFS sink")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\na1.sinks.k1.hdfs.path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /flume/test/%y-%m-%d/%H%M/%S\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#a1.sinks.k1.hdfs.filePrefix = %{fileName}")]),s._v("\na1.sinks.k1.hdfs.filePrefix "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" events-\na1.sinks.k1.hdfs.fileSuffix "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" .txt\na1.sinks.k1.hdfs.inUseSuffix "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\na1.sinks.k1.hdfs.round "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\na1.sinks.k1.hdfs.roundValue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\na1.sinks.k1.hdfs.roundUnit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" minute\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#防止出现NullPoinet异常")]),s._v("\na1.sinks.k1.hdfs.useLocalTimeStamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#防止写入到HDFS中文件内容乱码")]),s._v("\na1.sinks.k1.hdfs.fileType "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# channels使用内存来缓存")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使sources和sink通过channel关联起来")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br")])]),t("p",[s._v("配置说明：\n以上配置实现了输入（echo test exec to hdfs）到输出hdfs（/flume/test/%y-%m-%d/%H%M/%S）目录中")]),s._v(" "),t("ol",[t("li",[s._v("sources中配置了一个command，命令为：echo test exec to hdfs")]),s._v(" "),t("li",[s._v("sink中配置了输出到hdfs中具体的某个目录中，文件名的前缀后缀等信息")]),s._v(" "),t("li",[s._v("channels还是使用内存来缓存数据")])]),s._v(" "),t("h4",{attrs:{id:"启动agent"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动agent"}},[s._v("#")]),s._v(" 启动agent")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hadoop1 conf-example"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# flume-ng agent --conf conf --conf-file /usr/local/hadoop/flume-1.7.0/conf-example/exec-hdfs.conf --name a1 -Dflume.root.logger=INFO,console")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".省略部分信息"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("/10/19 00:27:31 INFO hdfs.BucketWriter: Creating /flume/test/17-10-19/0020/00/events-.1508344051412.txt.tmp\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("/10/19 00:27:31 WARN util.NativeCodeLoader: Unable to load native-hadoop library "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" your platform"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". using builtin-java classes where applicable\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[s._v("#")]),s._v(" 验证")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/BigData/Flume/0069RVTdgy1fu4fvrdd50j31kw05442h.jpg",alt:"img"}}),s._v("\n查看hdfs中该文件内容：\n"),t("img",{attrs:{src:"/img/BigData/Flume/0069RVTdgy1fu4g0poxlxj31kw03j76v.jpg",alt:"img"}})]),s._v(" "),t("h3",{attrs:{id:"spooldir到hdfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#spooldir到hdfs"}},[s._v("#")]),s._v(" spooldir到hdfs")]),s._v(" "),t("p",[t("strong",[s._v("监听文件夹中文件变化，然后存储到hdfs中")])]),s._v(" "),t("p",[s._v("实现目标：监控某目录下文件变化，如果有新文件则将该文件存储到hdfs中")]),s._v(" "),t("h4",{attrs:{id:"配置agent"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置agent"}},[s._v("#")]),s._v(" 配置agent")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义agent、sources、sinks、channels")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#--------sources-----------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exec sources")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" spooldir\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#监控/root/test目录中文件的变化")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意：不能往监控目中重复丢同名文件,否则会出现如下异常")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#java.lang.IllegalStateException: File name has been re-used with different files. Spooling assumptions violated for /root/test/a.txt.COMPLETED")]),s._v("\na1.sources.r1.spoolDir "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /root/test\na1.sources.r1.fileHeader "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#--------sink--------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HDFS sink")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\na1.sinks.k1.hdfs.path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /flume/test/%y-%m-%d/%H%M/%S\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#a1.sinks.k1.hdfs.filePrefix = %{fileName}")]),s._v("\na1.sinks.k1.hdfs.filePrefix "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" events-\na1.sinks.k1.hdfs.fileSuffix "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" .txt\na1.sinks.k1.hdfs.inUseSuffix "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\na1.sinks.k1.hdfs.round "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\na1.sinks.k1.hdfs.roundValue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\na1.sinks.k1.hdfs.roundUnit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" minute\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#防止出现NullPoinet异常")]),s._v("\na1.sinks.k1.hdfs.useLocalTimeStamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#防止写入到HDFS中文件内容乱码")]),s._v("\na1.sinks.k1.hdfs.fileType "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# channels使用内存来缓存")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使sources和sink通过channel关联起来")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br")])]),t("h4",{attrs:{id:"启动agent-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动agent-2"}},[s._v("#")]),s._v(" 启动agent")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("flume-ng agent --conf conf --conf-file /usr/local/hadoop/flume-1.7.0/conf-example/spooldir-hdfs.conf --name a1 -Dflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"验证-新增了一个a-txt文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证-新增了一个a-txt文件"}},[s._v("#")]),s._v(" 验证：新增了一个a.txt文件")]),s._v(" "),t("p",[s._v("在 /root/test目录中新增一些文件，然后查看agent终端日志信息，和hdfs文件系统中文件信息")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hadoop1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo abcd efg > a.txt")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hadoop1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\na.txt.COMPLETED\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("在往/root/test目录中添加了一个a.txt文件后，flume自动标记了该文件添加了一个.COMPLETED后缀。\n"),t("strong",[s._v("查看agent控制台输出")]),s._v(" "),t("img",{attrs:{src:"/img/BigData/Flume/0069RVTdgy1fu4fvn3nynj31kw06dq78.jpg",alt:"img"}}),s._v(" "),t("strong",[s._v("查看hdfs中文件变化")]),s._v(" "),t("img",{attrs:{src:"/img/BigData/Flume/0069RVTdgy1fu4g0wo695j31kw03oq4t.jpg",alt:"img"}})]),s._v(" "),t("h4",{attrs:{id:"验证-添加中文也是没问题的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证-添加中文也是没问题的"}},[s._v("#")]),s._v(" 验证：添加中文也是没问题的")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hadoop1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 中文 > b.txt")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hadoop1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\na.txt.COMPLETED  b.txt.COMPLETED\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("strong",[s._v("查看agent控制台输出")]),s._v(" "),t("img",{attrs:{src:"/img/BigData/Flume/0069RVTdgy1fu4fvyf9blj31kw047wi4.jpg",alt:"img"}}),s._v(" "),t("strong",[s._v("查看hdfs中文件变化")]),s._v(" "),t("img",{attrs:{src:"/img/BigData/Flume/0069RVTdgy1fu4fvtksyyj31kw02wacv.jpg",alt:"img"}})]),s._v(" "),t("h4",{attrs:{id:"验证-添加已经存在的重名文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证-添加已经存在的重名文件"}},[s._v("#")]),s._v(" 验证：添加已经存在的重名文件")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hadoop1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 123abc > a.txt")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hadoop1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\na.txt  a.txt.COMPLETED  b.txt.COMPLETED\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@hadoop1 test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("此时查看agent控制台日志，得到如下错误：\n"),t("img",{attrs:{src:"/img/BigData/Flume/006tNbRwgy1fw12dg67clj310w06wqfb.jpg",alt:""}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("java.lang.IllegalStateException: File name has been re-used with different files. Spooling assumptions violated "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" /root/test/a.txt.COMPLETED\n    at org.apache.flume.client.avro.ReliableSpoolingFileEventReader.rollCurrentFile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ReliableSpoolingFileEventReader.java:463"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    at org.apache.flume.client.avro.ReliableSpoolingFileEventReader.retireCurrentFile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ReliableSpoolingFileEventReader.java:414"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    at org.apache.flume.client.avro.ReliableSpoolingFileEventReader.readEvents"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ReliableSpoolingFileEventReader.java:326"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    at org.apache.flume.source.SpoolDirectorySource"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SpoolDirectoryRunnable")]),s._v(".run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SpoolDirectorySource.java:250"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    at java.util.concurrent.Executors"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$RunnableAdapter")]),s._v(".call"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Executors.java:511"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    at java.util.concurrent.FutureTask.runAndReset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("FutureTask.java:308"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    at java.util.concurrent.ScheduledThreadPoolExecutor"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ScheduledFutureTask")]),s._v(".access"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$301")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ScheduledThreadPoolExecutor.java:180"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    at java.util.concurrent.ScheduledThreadPoolExecutor"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ScheduledFutureTask")]),s._v(".run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ScheduledThreadPoolExecutor.java:294"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    at java.util.concurrent.ThreadPoolExecutor.runWorker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ThreadPoolExecutor.java:1142"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    at java.util.concurrent.ThreadPoolExecutor"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Worker")]),s._v(".run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ThreadPoolExecutor.java:617"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    at java.lang.Thread.run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Thread.java:748"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("结论：")]),s._v(" "),t("ol",[t("li",[s._v("不能在监控的目录下添加重名的文件，否则会出现File name has been re-used异常")]),s._v(" "),t("li",[s._v("不能监控文件内容的变化，只能监控不同文件的变化。例如：新增了一个文件b.txt，那么flume会将b.txt作为sources接入")])]),s._v(" "),t("h3",{attrs:{id:"spooldir到hdfs-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#spooldir到hdfs-2"}},[s._v("#")]),s._v(" spooldir到hdfs")]),s._v(" "),t("h3",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),t("p",[t("a",{attrs:{href:"http://flume.apache.org/FlumeUserGuide.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://flume.apache.org/FlumeUserGuide.html"),t("OutboundLink")],1),s._v(" "),t("a",{attrs:{href:"http://blog.csdn.net/qianshangding0708/article/details/49666821",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://blog.csdn.net/qianshangding0708/article/details/49666821"),t("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);
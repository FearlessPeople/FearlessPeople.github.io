(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{589:function(s,a,t){"use strict";t.r(a);var e=t(10),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"shell编码规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shell编码规范"}},[s._v("#")]),s._v(" Shell编码规范")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/ymattw/shell-style-guide/blob/master/shell-style-guide-cn.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("shell-style-guide-cn"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://zh-google-styleguide.readthedocs.io/en/latest/contents/",target:"_blank",rel:"noopener noreferrer"}},[s._v("[Google 开源项目风格指南]"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"命名规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命名规范"}},[s._v("#")]),s._v(" 命名规范")]),s._v(" "),t("h3",{attrs:{id:"文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件"}},[s._v("#")]),s._v(" 文件")]),s._v(" "),t("ul",[t("li",[s._v("文件名：全小写，扩展名为 "),t("code",[s._v(".sh")]),s._v("，文件名要有明确含义\n"),t("ul",[t("li",[s._v("主文件的文件名必要时采用连接符分隔，如 "),t("code",[s._v("build-foobar.sh")])]),s._v(" "),t("li",[s._v("函数库文件名以 "),t("code",[s._v("lib")]),s._v(" 开始，如 "),t("code",[s._v("liblog.sh")])])])]),s._v(" "),t("li",[s._v("文件编码：utf-8，以 LF (\\n) 分隔行，CR (\\r) 将引起错误")]),s._v(" "),t("li",[s._v("权限位：主文件加执行权限（chmod +x），但函数库文件不加")])]),s._v(" "),t("h3",{attrs:{id:"全局变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#全局变量"}},[s._v("#")]),s._v(" 全局变量")]),s._v(" "),t("p",[s._v("定义在所有函数之外的变量为全局变量。")]),s._v(" "),t("ul",[t("li",[s._v("全部大写，单词间以下划线连接")]),s._v(" "),t("li",[s._v("定义后不会修改的以 "),t("code",[s._v("readonly")]),s._v(" 修饰")])]),s._v(" "),t("p",[s._v("例如：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("readonly")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TOP_DIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/myapp"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("COMMAND_ARGS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$*")]),s._v('"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"函数名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#函数名"}},[s._v("#")]),s._v(" 函数名")]),s._v(" "),t("p",[s._v("全部小写，单词间以下划线连接。")]),s._v(" "),t("h3",{attrs:{id:"局部变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#局部变量"}},[s._v("#")]),s._v(" 局部变量")]),s._v(" "),t("p",[s._v("定义在函数内部的变量为“局部变量”，但如果不加 "),t("code",[s._v("local")]),s._v(" 修饰将"),t("strong",[s._v("全局可见")]),s._v("。")]),s._v(" "),t("ul",[t("li",[s._v("全部小写，单词间以下划线连接")]),s._v(" "),t("li",[s._v("在函数开始处统一以 "),t("code",[s._v("local")]),s._v(" 先声明后使用")]),s._v(" "),t("li",[s._v("整型数额外加 "),t("code",[s._v("-i")]),s._v(" 修饰")]),s._v(" "),t("li",[s._v("数组额外加 "),t("code",[s._v("-a")]),s._v(" 修饰")])]),s._v(" "),t("p",[s._v("例如：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("status_check")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("prog")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":?")]),s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" -i counter\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" -a args\n\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h2",{attrs:{id:"格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#格式"}},[s._v("#")]),s._v(" 格式")]),s._v(" "),t("h3",{attrs:{id:"解释器-shebang"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解释器-shebang"}},[s._v("#")]),s._v(" 解释器（shebang）")]),s._v(" "),t("p",[s._v("用 "),t("code",[s._v("#!/bin/bash")]),s._v("，无空格，不带选项。")]),s._v(" "),t("h3",{attrs:{id:"注释"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注释"}},[s._v("#")]),s._v(" 注释")]),s._v(" "),t("p",[s._v("注释用 "),t("code",[s._v("#")]),s._v(" 紧跟一个空格开始，用英文。")]),s._v(" "),t("p",[s._v("紧接 shebang 后之后要撰写头部注释：")]),s._v(" "),t("ul",[t("li",[s._v("解释文件的用途")]),s._v(" "),t("li",[s._v("简要解释如何使用（详细的写 usage 函数提供）")]),s._v(" "),t("li",[s._v("公司版权声明（如果有）")])]),s._v(" "),t("p",[s._v("其他约定：")]),s._v(" "),t("ul",[t("li",[s._v("代码中的注释，多行的在最后一行注释后额外加入一个空注释行")]),s._v(" "),t("li",[s._v("行尾注释，"),t("code",[s._v("#")]),s._v(" 符号之前至少留出两个空格")]),s._v(" "),t("li",[s._v("必要时使用特殊标记："),t("code",[s._v("TODO")]),s._v("，"),t("code",[s._v("FIXME")]),s._v("，"),t("code",[s._v("XXX")]),s._v("，多数编辑器能高亮显示它们")])]),s._v(" "),t("p",[s._v("例如：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This file stores the pid of the parent process")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PID_FILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/run/foo_daemon.pid"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This function probes a tcp port by trying to establish")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a connection without sending any data. Returns 0 on")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# success, 1 otherwise. TODO: implement an udp version")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("tcp_port_test")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("timeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# in second")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# FIXME: detect whether nc is installed")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" -w "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$port")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# XXX: on older system '-w' is not for connection timeout")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("提示："),t("code",[s._v("vimrc")]),s._v(" 中设置 "),t("code",[s._v("set formatoptions=tcroqnmMB")]),s._v(" 后，编辑多行注释时可在\nNormal 模式下按 "),t("code",[s._v("V")]),s._v(" 进入行模式，"),t("code",[s._v("j")]),s._v(" 和 "),t("code",[s._v("k")]),s._v(" 选择多行，然后 "),t("code",[s._v("gq")]),s._v(" 即可按当前行宽重排注释。")]),s._v(" "),t("h3",{attrs:{id:"行宽"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#行宽"}},[s._v("#")]),s._v(" 行宽")]),s._v(" "),t("p",[s._v("尽可能保持在 80 列以内，以便适应并排对比和打印输出的场合，使用 backslash "),t("code",[s._v("\\")]),s._v(" 断行。参考一些断行的写法：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Here we output a very very long message need to break into multiple"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lines with backslashes"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -Pzcf "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$backup_dir")]),s._v("/host-config.tar.gz "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    /etc/ssh/ssh_host* "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    /etc/ssh/sshd_config "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    /etc/hosts "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    /etc/postfix/main.cf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    /etc/postfix/relay_passwd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("以下 "),t("code",[s._v("vimrc")]),s._v(" 配置可将第 80 列的字符标成红色。更多请见 "),t("a",{attrs:{href:"https://github.com/ymattw/profiles/blob/1.1/vimrc#L134-L137",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考 vimrc 配置"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("div",{staticClass:"language-vim line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-vim"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("highlight")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" link CharAtCol80 WarningMsg\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("match")]),s._v(" CharAtCol80 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("80v"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"缩进"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缩进"}},[s._v("#")]),s._v(" 缩进")]),s._v(" "),t("p",[s._v("用四个空格缩进。以下示例 "),t("code",[s._v("vimrc")]),s._v(" 配置设定 tab 为 soft tab 四个空格，为 Makefile\n保持 hard tab。更多请见 "),t("a",{attrs:{href:"https://github.com/ymattw/profiles/blob/1.1/vimrc#L121-L129",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考 vimrc 配置\n"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("div",{staticClass:"language-vim line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-vim"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("expandtab")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("softtabstop")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("shiftwidth")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("tabstop")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("autocmd")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" BufEnter "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Mm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("akefile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Mm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("ake"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mak")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("setlocal")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("filetype")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("make")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("autocmd")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" FileType "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("setlocal")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("noexpandtab")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("shiftwidth")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"空行和空格"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#空行和空格"}},[s._v("#")]),s._v(" 空行和空格")]),s._v(" "),t("p",[s._v("使用单行空行分隔代码中的小段逻辑增加可读性。不留多余空格。使用下面 vim\n配置可以高亮显示去多余空白，且 Normal 模式下按空格开关显示。更多请见 "),t("a",{attrs:{href:"https://github.com/ymattw/profiles/blob/1.1/vimrc#L113-L117",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考\nvimrc 配置"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("div",{staticClass:"language-vim line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-vim"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("list")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("listchars")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tab")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("▸\\ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("trail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("▌\nnmap "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Space"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("list")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("CR"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("注：Windows 系统下对 utf-8 字符显示支持不完善，可考虑更换上面的两个特殊字符为 "),t("code",[s._v(">")]),s._v(" 和 "),t("code",[s._v("_")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"全局选项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#全局选项"}},[s._v("#")]),s._v(" 全局选项")]),s._v(" "),t("ul",[t("li",[s._v("始终使用 "),t("code",[s._v("set -o nounset")]),s._v(" 确保变量已经定义")]),s._v(" "),t("li",[s._v("在主文件且只在主文件中使用 "),t("code",[s._v("set -o errexit")]),s._v(" 第一时间捕获错误")])]),s._v(" "),t("p",[s._v("注：参考后面的“陷阱”一节。")]),s._v(" "),t("h3",{attrs:{id:"函数定义"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#函数定义"}},[s._v("#")]),s._v(" 函数定义")]),s._v(" "),t("p",[s._v("采用 "),t("code",[s._v("function func_name")]),s._v(" 并将开括弧放在下一行，不用多余的 "),t("code",[s._v("()")]),s._v(" 记号。这样至少有两个好处：")]),s._v(" "),t("ul",[t("li",[s._v("从文件中查找所有函数定义只需要 "),t("code",[s._v("grep ^function")]),s._v(" 即可")]),s._v(" "),t("li",[s._v("Vim 中设置 "),t("code",[s._v("smartindent")]),s._v(" 之后下一行会正确自动缩进")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("func_name")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"分支"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分支"}},[s._v("#")]),s._v(" 分支")]),s._v(" "),t("p",[s._v("将 "),t("code",[s._v("then")]),s._v(" 放在和 "),t("code",[s._v("if")]),s._v(" 同一行。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" condition "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" condition "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"循环"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#循环"}},[s._v("#")]),s._v(" 循环")]),s._v(" "),t("p",[s._v("将 "),t("code",[s._v("do")]),s._v(" 放在和 "),t("code",[s._v("for")]),s._v(" 和 "),t("code",[s._v("while")]),s._v(" 同一行。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("x")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bar"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"quz"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"case"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#case"}},[s._v("#")]),s._v(" Case")]),s._v(" "),t("ul",[t("li",[s._v("分支缩进四格")]),s._v(" "),t("li",[s._v("结束符 "),t("code",[s._v(";;")]),s._v(" 单独一行")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OS")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n    Linux"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"This is a Linux system"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    Darwin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"This is a Mac system"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    *"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Unknown OS '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OS")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&2")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"变量引用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#变量引用"}},[s._v("#")]),s._v(" 变量引用")]),s._v(" "),t("p",[s._v("可能引起阅读困难时使用 "),t("code",[s._v("${VAR}")]),s._v("，例如对比下面两种写法，使用第一种。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Good")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LOG_FILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOG_PREFIX}")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PROG_NAME}")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOG_SUFFIX}")]),s._v('"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bad")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LOG_FILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$LOG_PREFIX")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROG_NAME")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$LOG_SUFFIX")]),s._v('"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"引号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#引号"}},[s._v("#")]),s._v(" 引号")]),s._v(" "),t("p",[s._v("因为需要引用变量的场合占多数，字符串使用双引号，除非下面两种情况：")]),s._v(" "),t("ul",[t("li",[s._v("需要规避变量展开")]),s._v(" "),t("li",[s._v("字符串内部有多处双引号需要转义")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("readonly")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TOP_DIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/myapp"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("readonly")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CONFIG")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TOP_DIR")]),s._v('/myapp.conf"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("使用单引号场合示例：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("start")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("banner")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Welcome to the \"Awesome Portal\"'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'loaded$'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"导入其他文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导入其他文件"}},[s._v("#")]),s._v(" 导入其他文件")]),s._v(" "),t("p",[s._v("用 "),t("code",[s._v("source")]),s._v(" 而不是点 "),t("code",[s._v(".")]),s._v(" 因为前者可读性更好。")]),s._v(" "),t("h3",{attrs:{id:"命令替换-subshell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令替换-subshell"}},[s._v("#")]),s._v(" 命令替换（subshell）")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("$(..)")]),s._v(" 而不是 `..` 因为前者可读性更好并且能嵌套。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SELF_DIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$(")]),s._v("dirname $0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"条件测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#条件测试"}},[s._v("#")]),s._v(" 条件测试")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("[[ .. ]]")]),s._v(" 而不是 "),t("code",[s._v("[ .. ]")]),s._v(" 或 "),t("code",[s._v("test")]),s._v("，因为第一种容错性最好。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FOO")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("不用 "),t("code",[s._v('[[ "x$FOO" == "x" ]]')]),s._v(" 这种传承自古老 Unix 系统的写法，改用 "),t("code",[s._v('[[ -z "$FOO" ]]')]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"算术运算"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#算术运算"}},[s._v("#")]),s._v(" 算术运算")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("(( .. ))")]),s._v("，注意类似 "),t("code",[s._v("[[ .. ]]")]),s._v(" 内部前后各留一个空格。括弧内的变量不使用 "),t("code",[s._v("$")]),s._v(" 引用。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v(" COUNTER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v(" COUNTER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" TIMEOUT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"here-document"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#here-document"}},[s._v("#")]),s._v(" Here document")]),s._v(" "),t("p",[s._v("需要写大段文本或模板时采用 here document。无需变量展开时结束符使用双引号。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("usage")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOT\n\nUsage: "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v(" [options]\n\n--help          Display this message and exit\n--file FILE     Specify target filename, default is /etc/myapp.conf\n\nEOT")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MESSAGE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EOT"\nPrices list:\n\n- Foo: $2.99\n- Bar: $1.49\nEOT')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h2",{attrs:{id:"惯例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#惯例"}},[s._v("#")]),s._v(" 惯例")]),s._v(" "),t("h3",{attrs:{id:"环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[s._v("#")]),s._v(" 环境")]),s._v(" "),t("p",[s._v("注意很多系统下 "),t("code",[s._v("/usr/sbin")]),s._v(" 和 "),t("code",[s._v("/sbin")]),s._v(" 不在默认路径中，如果程序里引用到它们下的命令，将它们加进\n"),t("code",[s._v("PATH")]),s._v("。安全性敏感的脚本，应显式设置 PATH，如：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("小心处理一些常见的环境变量，例如启动一个 Java 应用时，如果依赖系统默认安装的\nJava 环境，应 "),t("code",[s._v("unset JAVA_HOME")]),s._v(" 等避免受用户环境干扰。")]),s._v(" "),t("h3",{attrs:{id:"错误输出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误输出"}},[s._v("#")]),s._v(" 错误输出")]),s._v(" "),t("p",[s._v("错误信息输出到 "),t("code",[s._v("&2")]),s._v(" (stderr)，仅当条件测试时才考虑重定向至 "),t("code",[s._v("/dev/null")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ERROR: nc is not installed, aborting"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&2")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"当前目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#当前目录"}},[s._v("#")]),s._v(" 当前目录")]),s._v(" "),t("p",[s._v("不要改变当前目录，也不采用 "),t("code",[s._v("pushd")]),s._v(" 和 "),t("code",[s._v("popd")]),s._v("，因为会给维护者增加负担。")]),s._v(" "),t("p",[s._v("如果需要得到当前脚本的绝对路径，采用下面方法：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SELF_DIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$(")]),s._v("dirname $0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("尽量使用一些程序自己的特性改变目录，如 "),t("code",[s._v("tar -C")]),s._v("，"),t("code",[s._v("patch -d")]),s._v("。如果需要临时改变当前目录，采用子 shell：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /tmp/foo\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"临时文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#临时文件"}},[s._v("#")]),s._v(" 临时文件")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("mktemp")]),s._v(" 创建临时文件和目录，采用 "),t("code",[s._v("trap EXIT")]),s._v(" 做清理。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TMP_DIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("mktemp -d /tmp/foo.XXXXXXXXXX"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TMP_FILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("mktemp /tmp/bar.XXXXXXXXXX"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("trap")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rm -rf '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TMP_DIR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TMP_FILE")]),s._v('"')]),s._v(" EXIT\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"检查输入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查输入"}},[s._v("#")]),s._v(" 检查输入")]),s._v(" "),t("ul",[t("li",[s._v("采用全局选项 "),t("code",[s._v("set -o nounset")]),s._v(" 确保变量展开时已定义")]),s._v(" "),t("li",[s._v("使用 "),t("code",[s._v("${VAR:?}")]),s._v(" 或 "),t("code",[s._v('${VAR:?"Error mssage"}')]),s._v(" 确保关键变量已经定义且非空")]),s._v(" "),t("li",[s._v("用 "),t("code",[s._v('${VAR:-"default value"}')]),s._v(" 设置变量默认值")])]),s._v(" "),t("p",[s._v("考虑下面的例子，如果变量名不慎写错，运行时前一种就会及时报错，后一种则将会发生惨剧 😃。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Good")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TEMPORARY_DATA_DIR"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":?")]),s._v("}")]),s._v("/*\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bad")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TEMPORARY_DATA_DIR")]),s._v("/*\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("检查函数输入参数的例子：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("status_check")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("prog_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":?")]),s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("timeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v("5}")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# In second")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"main-函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#main-函数"}},[s._v("#")]),s._v(" Main 函数")]),s._v(" "),t("p",[s._v("尽量用函数组织代码中的独立逻辑，函数外的代码留给全局变量定义，其他代码变多时放进 "),t("code",[s._v("main")]),s._v(" 函数，然后按如下方式调用：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("main "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"和"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#和"}},[s._v("#")]),s._v(" '&&' 和 '||'")]),s._v(" "),t("p",[s._v("仅将 "),t("code",[s._v("&&")]),s._v(" 和 "),t("code",[s._v("||")]),s._v(" 用于连接多个测试条件。"),t("code",[s._v("||")]),s._v(" 适用于“断言（assertion）”时方可接命令语句。一些例子如下：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Good: assertion")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v(" $# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" usage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Good")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -r "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$conf")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -q "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foobar"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$conf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    load_config "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Bad: may be suffered by "set -o errexit" when the config file does not exist')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -r "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$config")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -q "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foobar"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$conf")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" load_config "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$conf")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"exit-vs-return"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#exit-vs-return"}},[s._v("#")]),s._v(" Exit vs return")]),s._v(" "),t("p",[s._v("函数内部只使用 "),t("code",[s._v("return")]),s._v("，返回 "),t("code",[s._v("0")]),s._v(" 代表成功，返回 "),t("code",[s._v("1")]),s._v(" 代表失败。"),t("code",[s._v("exit")]),s._v(" 只用于主程序。")]),s._v(" "),t("h3",{attrs:{id:"builtin-vs-外部命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#builtin-vs-外部命令"}},[s._v("#")]),s._v(" Builtin vs 外部命令")]),s._v(" "),t("p",[s._v("优先使用 builtin (内置) 命令，如")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Good")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$((")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" y "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("))")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FILE_SUFFIX")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PATHNAME"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%%")]),s._v("*.}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bad")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("expr")]),s._v(" $x + $y"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FILE_SUFFIX")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(' "$PATHNAME '),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/.*\\.//'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"陷阱"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#陷阱"}},[s._v("#")]),s._v(" 陷阱")]),s._v(" "),t("h3",{attrs:{id:"选项-errexit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#选项-errexit"}},[s._v("#")]),s._v(" 选项 errexit")]),s._v(" "),t("p",[s._v("启用了 "),t("code",[s._v("set -o errexit")]),s._v(" 时小心每条命令的返回值，它的作用是任何命令返回值 "),t("code",[s._v("$?")]),s._v(" 非 0 时即让程序将直接退出。但它在下面几种情形时不起作用：")]),s._v(" "),t("ul",[t("li",[s._v("命令跟在 while, until, if 关键字之后")]),s._v(" "),t("li",[s._v("命令是 "),t("code",[s._v("&&")]),s._v(" 或 "),t("code",[s._v("||")]),s._v(" 语句的一部分")]),s._v(" "),t("li",[t("code",[s._v("! foo")])])]),s._v(" "),t("p",[s._v("应当显示中断执行，例如 "),t("code",[s._v("! foo")]),s._v(" 该写成：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" foo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("对于不会输出错误信息的命令，还要显式输出，以便容易知道程序终止在何处。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" -w "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$port")]),s._v(' seems unreachable"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&2")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"subshell-给-local-变量赋值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#subshell-给-local-变量赋值"}},[s._v("#")]),s._v(" Subshell 给 local 变量赋值")]),s._v(" "),t("p",[s._v("注意 "),t("code",[s._v("local output=$(foo_command)")]),s._v(" 赋值始终会成功（返回 0），若依赖命令返回值，要分开两行写：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" output\n\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("output")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("foo_command"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# errexit will capture the return value")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"shift"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shift"}},[s._v("#")]),s._v(" Shift")]),s._v(" "),t("p",[s._v("小心 "),t("code",[s._v("shift 2")]),s._v(" 在参数个数小于 2 时的行为将是一个也不移，在某些系统上并不返回错误，应改成 "),t("code",[s._v("shift; shift")]),s._v("。")]),s._v(" "),t("h2",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),t("p",[s._v("[1] "),t("a",{attrs:{href:"https://google-styleguide.googlecode.com/svn/trunk/shell.xml",target:"_blank",rel:"noopener noreferrer"}},[s._v("Google Shell Style Guide"),t("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);
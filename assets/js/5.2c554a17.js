(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{419:function(a,s,t){a.exports=t.p+"assets/img/mk-20220730164742.0cf8eb27.png"},420:function(a,s,t){a.exports=t.p+"assets/img/mk-20220730164802.924dbf88.png"},421:function(a,s,t){a.exports=t.p+"assets/img/mk-20220730164916.7cca7e97.png"},505:function(a,s,t){"use strict";t.r(s);var n=t(10),e=Object(n.a)({},(function(){var a=this,s=a.$createElement,n=a._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h2",{attrs:{id:"介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[a._v("#")]),a._v(" 介绍")]),a._v(" "),n("p",[a._v("本文主要记录了使用canal解析MySQL的binlog日志，然后将数据发送到kafka的过程。")]),a._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/alibaba/canal",target:"_blank",rel:"noopener noreferrer"}},[a._v("canal官网"),n("OutboundLink")],1)]),a._v(" "),n("h2",{attrs:{id:"mysql开启binlog"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql开启binlog"}},[a._v("#")]),a._v(" mysql开启binlog")]),a._v(" "),n("p",[a._v("参考Canal的"),n("a",{attrs:{href:"https://github.com/alibaba/canal/wiki/QuickStart",target:"_blank",rel:"noopener noreferrer"}},[a._v("QuickStart"),n("OutboundLink")],1)]),a._v(" "),n("p",[a._v("编辑"),n("code",[a._v("/etc/my.cnf")]),a._v("文件，增加如下配置")]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("mysqld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("datadir")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/var/lib/mysql\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("socket")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/var/lib/mysql/mysql.sock\n\nlog-bin"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mysql-bin "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#添加这一行就ok")]),a._v("\nbinlog-format"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("ROW "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#选择row模式")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("server_id")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#配置mysql replaction需要定义，不能和canal的slaveId重复")]),a._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("mysqld_safe"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nlog-error"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/var/log/mysqld.log\npid-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/var/run/mysqld/mysqld.pid\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br")])]),n("h3",{attrs:{id:"_1-验证是否开启binlog"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-验证是否开启binlog"}},[a._v("#")]),a._v(" 1. 验证是否开启"),n("code",[a._v("binlog")])]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("mysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" SHOW VARIABLES LIKE "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("'%log_bin%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n+---------------------------------+--------------------------------+\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" Variable_name                   "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" Value                          "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n+---------------------------------+--------------------------------+\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" log_bin                         "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" ON                             "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" log_bin_basename                "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" /var/lib/mysql/mysql-bin       "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" log_bin_index                   "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" /var/lib/mysql/mysql-bin.index "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" log_bin_trust_function_creators "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" OFF                            "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" log_bin_use_v1_row_events       "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" OFF                            "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" sql_log_bin                     "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" ON                             "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n+---------------------------------+--------------------------------+\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),n("p",[a._v("提示：\nlog_bin等于on表示成功开启了binlog")])]),a._v(" "),n("h3",{attrs:{id:"_2-查看master状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-查看master状态"}},[a._v("#")]),a._v(" 2. 查看master状态")]),a._v(" "),n("p",[a._v("即最后（最新）一个binlog日志的编号名称，及其最后一个操作事件pos结束点(Position)值。")]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("mysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" show master status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n+------------------+----------+--------------+------------------+-------------------------------------------------+\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" File             "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" Position "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" Binlog_Do_DB "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" Binlog_Ignore_DB "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" Executed_Gtid_Set                               "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n+------------------+----------+--------------+------------------+-------------------------------------------------+\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql-bin.000020 "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("56217764")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("              "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("                  "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" ad9a34e4-bd71-11e9-b5b2-00163e143f99:1-19076813 "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n+------------------+----------+--------------+------------------+-------------------------------------------------+\n"),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" row "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.03")]),a._v(" sec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br")])]),n("h2",{attrs:{id:"canal配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#canal配置"}},[a._v("#")]),a._v(" canal配置")]),a._v(" "),n("p",[a._v("参考Canal的"),n("a",{attrs:{href:"https://github.com/alibaba/canal/wiki/QuickStart",target:"_blank",rel:"noopener noreferrer"}},[a._v("QuickStart"),n("OutboundLink")],1)]),a._v(" "),n("h3",{attrs:{id:"_1-下载canal"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-下载canal"}},[a._v("#")]),a._v(" 1. 下载canal")]),a._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/alibaba/canal/releases",target:"_blank",rel:"noopener noreferrer"}},[a._v("canal下载地址"),n("OutboundLink")],1)]),a._v(" "),n("p",[a._v("下载"),n("code",[a._v("canal.deployer-1.1.4.tar.gz")]),a._v("文件")]),a._v(" "),n("p",[a._v("解压到某个目录")]),a._v(" "),n("h3",{attrs:{id:"_2-创建canal用户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建canal用户"}},[a._v("#")]),a._v(" 2. 创建canal用户")]),a._v(" "),n("p",[a._v("下载好canal后，需要在MySQL中创建个canal用户，然后对canal用户授权（主要是"),n("code",[a._v("slave")]),a._v("权限)")]),a._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CREATE")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("USER")]),a._v(" canal IDENTIFIED "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("BY")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("'canal'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("  \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("GRANT")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SELECT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("REPLICATION")]),a._v(" SLAVE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("REPLICATION")]),a._v(" CLIENT "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ON")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("TO")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("'canal'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@'%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- GRANT ALL PRIVILEGES ON *.* TO 'canal'@'%' ;")]),a._v("\nFLUSH "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("PRIVILEGES")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br")])]),n("h3",{attrs:{id:"_3-canal的基本配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-canal的基本配置"}},[a._v("#")]),a._v(" 3. canal的基本配置")]),a._v(" "),n("p",[a._v("canal是多实例的特性，所以一个canal是可以监控多个MySQL服务的，每个MySQL服务代表一个"),n("code",[a._v("instance")]),a._v("\n多实例配置，请参考\n"),n("a",{attrs:{href:"https://www.2cto.com/database/201609/547661.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("canal多instance配置方式"),n("OutboundLink")],1)]),a._v(" "),n("h4",{attrs:{id:"vi-conf-example-instance-properties"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vi-conf-example-instance-properties"}},[a._v("#")]),a._v(" vi conf/example/instance.properties")]),a._v(" "),n("p",[a._v("编辑"),n("code",[a._v("canal.deployer-1.1.4.tar.gz")]),a._v("中的"),n("code",[a._v("vi conf/example/instance.properties")]),a._v("文件")]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## mysql serverId")]),a._v("\ncanal.instance.mysql.slaveId "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("1234")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#position info，需要改成自己的数据库信息")]),a._v("\ncanal.instance.master.address "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:3306 \ncanal.instance.master.journal.name "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" \ncanal.instance.master.position "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" \ncanal.instance.master.timestamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#canal.instance.standby.address = ")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#canal.instance.standby.journal.name =")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#canal.instance.standby.position = ")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#canal.instance.standby.timestamp = ")]),a._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#username/password，需要改成自己的数据库信息")]),a._v("\ncanal.instance.dbUsername "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" canal  \ncanal.instance.dbPassword "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" canal\ncanal.instance.defaultDatabaseName "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("\ncanal.instance.connectionCharset "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" UTF-8\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#table regex【配置要监控的数据库】")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 常见例子：")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 1. 所有表：.* or .*\\\\..*")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 2. canal schema下所有表： canal\\\\..*")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 3. canal下的以canal打头的表：canal\\\\.canal.*")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 4. canal schema下的一张表：canal.test1")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 5. 多个规则组合使用：canal\\\\..*,mysql.test1,mysql.test2 (逗号分隔)")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 注意：此过滤条件只针对row模式的数据有效(ps. mixed/statement因为不解析sql，所以无法准确提取tableName进行过滤)  .*\\\\..*")]),a._v("\ncanal.instance.filter.regex "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" ."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("*"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("*\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br"),n("span",{staticClass:"line-number"},[a._v("15")]),n("br"),n("span",{staticClass:"line-number"},[a._v("16")]),n("br"),n("span",{staticClass:"line-number"},[a._v("17")]),n("br"),n("span",{staticClass:"line-number"},[a._v("18")]),n("br"),n("span",{staticClass:"line-number"},[a._v("19")]),n("br"),n("span",{staticClass:"line-number"},[a._v("20")]),n("br"),n("span",{staticClass:"line-number"},[a._v("21")]),n("br"),n("span",{staticClass:"line-number"},[a._v("22")]),n("br"),n("span",{staticClass:"line-number"},[a._v("23")]),n("br"),n("span",{staticClass:"line-number"},[a._v("24")]),n("br"),n("span",{staticClass:"line-number"},[a._v("25")]),n("br"),n("span",{staticClass:"line-number"},[a._v("26")]),n("br"),n("span",{staticClass:"line-number"},[a._v("27")]),n("br")])]),n("h3",{attrs:{id:"_4-canal的kafka配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-canal的kafka配置"}},[a._v("#")]),a._v(" 4. canal的kafka配置")]),a._v(" "),n("p",[a._v("参考"),n("a",{attrs:{href:"https://github.com/alibaba/canal/wiki/Canal-Kafka-RocketMQ-QuickStart",target:"_blank",rel:"noopener noreferrer"}},[a._v("Canal Kafka/RocketMQ QuickStart"),n("OutboundLink")],1)]),a._v(" "),n("p",[n("strong",[a._v("修改"),n("code",[a._v("instance")]),a._v("配置文件"),n("code",[a._v("vi conf/example/instance.properties")])])]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置kafka的topic")]),a._v("\ncanal.mq.topic"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("example\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 针对库名或者表名发送动态topic")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#canal.mq.dynamicTopic=mytest,.*,mytest.user,mytest\\\\..*,.*\\\\..*")]),a._v("\ncanal.mq.partition"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# hash partition config")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#canal.mq.partitionsNum=3")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#库名.表名: 唯一主键，多个表之间用逗号分隔")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#canal.mq.partitionHash=mytest.person:id,mytest.role:id")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#################################################")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br")])]),n("p",[n("strong",[a._v("修改"),n("code",[a._v("canal")]),a._v(" 配置文件"),n("code",[a._v("vi /usr/local/canal/conf/canal.properties")])])]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 1、设置为kafka")]),a._v("\ncanal.serverMode "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" kafka\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 2、kafka/rocketmq 集群配置: 192.168.1.117:9092,192.168.1.118:9092,192.168.1.119:9092")]),a._v("\ncanal.mq.servers "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.15")]),a._v(".1.17:9092,10.15.1.18:9092,10.15.1.19:9092\ncanal.mq.retries "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\ncanal.mq.batchSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("16384")]),a._v("\ncanal.mq.maxRequestSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("1048576")]),a._v("\ncanal.mq.lingerMs "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),a._v("\ncanal.mq.bufferMemory "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("33554432")]),a._v("\ncanal.mq.canalBatchSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("50")]),a._v("\ncanal.mq.canalGetTimeout "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),a._v("\ncanal.mq.flatMessage "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\ncanal.mq.compressionType "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" none\ncanal.mq.acks "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" all\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#canal.mq.properties. =")]),a._v("\ncanal.mq.producerGroup "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v('# Set this value to "cloud", if you want open message trace feature in aliyun.')]),a._v("\ncanal.mq.accessChannel "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("local")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# aliyun mq namespace")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#canal.mq.namespace =")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br"),n("span",{staticClass:"line-number"},[a._v("15")]),n("br"),n("span",{staticClass:"line-number"},[a._v("16")]),n("br"),n("span",{staticClass:"line-number"},[a._v("17")]),n("br"),n("span",{staticClass:"line-number"},[a._v("18")]),n("br"),n("span",{staticClass:"line-number"},[a._v("19")]),n("br"),n("span",{staticClass:"line-number"},[a._v("20")]),n("br"),n("span",{staticClass:"line-number"},[a._v("21")]),n("br")])]),n("h3",{attrs:{id:"_5-启动canal"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-启动canal"}},[a._v("#")]),a._v(" 5. 启动canal")]),a._v(" "),n("p",[n("strong",[a._v("启动")])]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" bin/startup.sh\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("p",[n("strong",[a._v("查看 server 日志")])]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" logs/canal/canal.log"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("/pre"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("2013")]),a._v("-02-05 "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(":45:27.967 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" INFO  com.alibaba.otter.canal.deployer.CanalLauncher - "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## start the canal server.")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("2013")]),a._v("-02-05 "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(":45:28.113 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" INFO  com.alibaba.otter.canal.deployer.CanalController - "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## start the canal server[10.1.29.120:11111]")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("2013")]),a._v("-02-05 "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(":45:28.210 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" INFO  com.alibaba.otter.canal.deployer.CanalLauncher - "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## the canal server is running now ......")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br")])]),n("p",[n("strong",[a._v("查看 instance 的日志")])]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" logs/example/example.log\n"),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("2013")]),a._v("-02-05 "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(":50:45.636 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" INFO  c.a.o.c.i.spring.support.PropertyPlaceholderConfigurer - Loading properties "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),a._v(" from class path resource "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("canal.properties"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("2013")]),a._v("-02-05 "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(":50:45.641 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" INFO  c.a.o.c.i.spring.support.PropertyPlaceholderConfigurer - Loading properties "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),a._v(" from class path resource "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("example/instance.properties"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("2013")]),a._v("-02-05 "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(":50:45.803 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" INFO  c.a.otter.canal.instance.spring.CanalInstanceWithSpring - start CannalInstance "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("-example \n"),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("2013")]),a._v("-02-05 "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(":50:45.810 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" INFO  c.a.otter.canal.instance.spring.CanalInstanceWithSpring - start successful"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br")])]),n("p",[n("strong",[a._v("关闭")])]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" bin/stop.sh\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("h2",{attrs:{id:"验证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[a._v("#")]),a._v(" 验证")]),a._v(" "),n("h3",{attrs:{id:"_1-在mysql中修改数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-在mysql中修改数据"}},[a._v("#")]),a._v(" 1. 在MySQL中修改数据")]),a._v(" "),n("p",[n("img",{attrs:{src:t(419),alt:""}})]),a._v(" "),n("h3",{attrs:{id:"_2-在kafka中消费数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-在kafka中消费数据"}},[a._v("#")]),a._v(" 2. 在kafka中消费数据")]),a._v(" "),n("p",[n("strong",[a._v("启动kafka的consumer")])]),a._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[a._v("kafka-console-consumer --zookeeper "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.15")]),a._v(".1.23:2181,10.15.1.18:2181,10.15.1.19:2181 --from-beginning --topic petmedical\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("p",[n("strong",[a._v("在控制台查看数据")])]),a._v(" "),n("p",[n("img",{attrs:{src:t(420),alt:""}})]),a._v(" "),n("p",[n("strong",[a._v("格式化json数据")])]),a._v(" "),n("p",[n("img",{attrs:{src:t(421),alt:""}})])])}),[],!1,null,null,null);s.default=e.exports}}]);